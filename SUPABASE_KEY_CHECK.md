# Supabase Key Configuration Check

**Date:** 2025-01-27  
**Purpose:** Verify if wrong Supabase key is causing /auth 404 issue

---

## HYPOTHESIS

The `/auth` route 404 error might be caused by using the wrong Supabase key (service role key instead of anon/public key) in the client configuration.

---

## CURRENT CONFIGURATION

### Client Configuration
**File:** `src/integrations/supabase/client.ts`

```typescript
const SUPABASE_PUBLISHABLE_KEY = import.meta.env.VITE_SUPABASE_PUBLISHABLE_KEY;

export const supabase = createClient<Database>(
  SUPABASE_URL, 
  SUPABASE_PUBLISHABLE_KEY,  // Should be ANON/PUBLIC key
  { auth: { ... } }
);
```

**Expected:** `VITE_SUPABASE_PUBLISHABLE_KEY` should contain the **anon/public key**

---

## KEY TYPES IN SUPABASE

### 1. Anon/Public Key (CORRECT for client)
- **Purpose:** Client-side authentication
- **Format:** JWT token starting with `eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...`
- **Length:** ~200-300 characters
- **Security:** Public, safe to expose in client code
- **RLS:** Respects Row Level Security policies
- **Where to find:** Supabase Dashboard → Settings → API → `anon` `public` key

### 2. Service Role Key (WRONG for client)
- **Purpose:** Server-side/admin operations only
- **Format:** JWT token, different structure
- **Length:** ~200-300 characters (similar length)
- **Security:** SECRET - should NEVER be in client code
- **RLS:** Bypasses Row Level Security (admin access)
- **Where to find:** Supabase Dashboard → Settings → API → `service_role` `secret` key

---

## HOW TO VERIFY

### Step 1: Check Environment Variable

**File:** `.env` (auto-generated by Lovable Cloud)

**Check:**
```bash
# Should see:
VITE_SUPABASE_PUBLISHABLE_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6...
```

**Verify:**
- Key starts with `eyJ` (JWT format)
- Key is NOT the service_role key
- Key matches the anon/public key from Supabase dashboard

### Step 2: Check Supabase Dashboard

1. Go to Supabase Dashboard
2. Navigate to: Project Settings → API
3. Find "Project API keys"
4. Compare:
   - `anon` `public` key → Should match `VITE_SUPABASE_PUBLISHABLE_KEY`
   - `service_role` `secret` key → Should NOT match (this is wrong)

### Step 3: Check Browser Console

**If wrong key is used, you might see:**
- `Invalid API key` errors
- `Authentication error` messages
- Module initialization errors
- Supabase client creation failures

**Check for:**
```javascript
// In browser console, look for:
- Supabase initialization errors
- Auth state change errors
- API request failures
```

### Step 4: Check Network Tab

**Look for:**
- Failed requests to Supabase API
- 401/403 errors on auth endpoints
- CORS errors (unlikely but possible)

---

## POTENTIAL IMPACT

### If Service Role Key is Used in Client:

1. **Security Risk:** ⚠️ CRITICAL
   - Service role key bypasses RLS
   - Anyone with access to client code can see the key
   - Could allow unauthorized database access

2. **Functional Issues:**
   - Auth might work but bypass security
   - RLS policies ignored
   - Could cause unexpected behavior

3. **Routing Issues (If Error Prevents Load):**
   - If key error throws during module import
   - App might fail to initialize
   - Could manifest as 404 if error prevents React Router from loading

---

## HOW TO FIX

### If Wrong Key Found:

1. **Get Correct Key:**
   - Supabase Dashboard → Settings → API
   - Copy `anon` `public` key (NOT service_role)

2. **Update Configuration:**
   - Note: `.env` is auto-generated by Lovable Cloud
   - May need to update in Lovable Cloud settings
   - Or check if there's a way to override

3. **Verify Fix:**
   - Check browser console for errors
   - Test auth flow
   - Verify routes work

---

## VERIFICATION CHECKLIST

- [ ] Check `.env` file for `VITE_SUPABASE_PUBLISHABLE_KEY`
- [ ] Verify key matches anon/public key from Supabase dashboard
- [ ] Confirm key is NOT service_role key
- [ ] Check browser console for Supabase errors
- [ ] Test auth initialization
- [ ] Verify routes load correctly after fix

---

## NOTES

- **Lovable Cloud:** `.env` is auto-generated, may need to check Lovable Cloud project settings
- **Key Format:** Both keys are JWT tokens, so format alone doesn't distinguish them
- **Key Location:** Must check Supabase dashboard to confirm which key is which
- **Security:** Never commit service_role key to client code

---

**END OF SUPABASE KEY CHECK**









